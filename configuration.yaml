homeassistant:
  # Name of the location where Home Assistant is running
  name: !secret name
  # Location required to calculate the time the sun rises and sets
  latitude: !secret latitude
  longitude: !secret longitude
  # Impacts weather/sunrise data (altitude above sea level in meters)
  elevation: !secret elevation
  # metric for Metric, imperial for Imperial
  unit_system: metric
  # Pick yours from here: http://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  time_zone: !secret time_zone
  customize: !include customize.yaml
    
#Show links to resources in log and frontend
#introduction:

http:
  api_password: !secret api_password
#This works for https://gb53smith.duckdns.org from an external network
#but not from my internal network.  Will work on chrome
  ssl_certificate: /etc/letsencrypt/live/gb53smith.duckdns.org/fullchain.pem
  ssl_key: /etc/letsencrypt/live/gb53smith.duckdns.org/privkey.pem
  base_url: gb53smith.duckdns.org

#This start the MQTT server on Raspberry setup using the HA install script
#To access from an Arduino deviceI had to use the IP address for the Raspberry
mqtt:
  broker: localhost 
  port: 1883
  client_id: home-assistant-1
  keepalive: 60
  username: gbsmith
  password: mos123
  protocol: 3.1 
  
zwave:
  usb_path: /dev/ttyACM0
  config_path: /home/homeassistant/.homeassistant/ozw_config
  polling_interval: 30000
  device_config:
    light.ge_12724_3way_dimmer_switch_level_8_0: # Added to keep HA in sync after manual override
      refresh_value: true #refresh the brightness value if the dimmer do "soft off"
      delay: 2 #Amount of seconds before the refresh is done after the actual action.
      polling_intensity: 1 #Polls the device when each (polling_intensity) polling is performed by polling_interval

# Enables the frontend
frontend:

# Enables configuration UI
config:

# Checks for available updates
updater:

# Discover some devices automatically
discovery:

# Allows you to issue voice commands from the frontend in enabled browsers
#conversation:

# View all events in a logbook
logbook:

# Keep database from growing too large by purging
recorder:
  purge_days: 30
 
# Enables support for tracking state changes over time.
# Exclude those domains and entities that do not change much 
history:
  exclude:
    domains:
      - automation
      - script
    entities:
      - binary_sensor.away
      - device_tracker.grahams_iphone
      - group.zwave_components
      - group.all_switches
      - group.alarms
      - group.irrigation_automation
      - group.irrigation_switches
      - group.living_room_light_automation
      - group.back_door_lock
      - group.switches_off_at_restart
      - group.temperature_control
      - input_boolean.vacation
      - lock.schlage_be469nxcen_touchscreen_deadbolt_locked_4_0
      - sensor.schlage_be469nxcen_touchscreen_deadbolt_access_control_4_9
      - sensor.schlage_be469nxcen_touchscreen_deadbolt_alarm_level_4_1
      - sensor.schlage_be469nxcen_touchscreen_deadbolt_alarm_type_4_0
      - sensor.schlage_be469nxcen_touchscreen_deadbolt_burglar_4_10
      - sensor.schlage_be469nxcen_touchscreen_deadbolt_power_management_4_11
      - sensor.schlage_be469nxcen_touchscreen_deadbolt_sourcenodeid_4_2
      - sensor.schlage_be469nxcen_touchscreen_deadbolt_system_4_12
      - sensor.grahams_iphone_battery_level
      - sensor.grahams_iphone_battery_state
      - sensor.joyce_ipad_battery_level
      - sensor.joyce_ipad_battery_state
      - sensor.lock_battery
      - sensor.ssl_cert_expiry
      - sensor.yesterday_rainfall
      - sensor.motion
      - sensor.rgb_state
      - sun.sun
      - switch.heat0
      - switch.heat1
      - zwave.aeotec_zw090_zstick_gen5_us_1
      - zwave.schlage_be469nxcen_touchscreen_deadbolt_4
      - zwave.leviton_dzr151lz_binary_scene_switch_7
      - zwave.ge_12724_3way_dimmer_switch_8
  
#Send notifications to the iOS app on my iPhone
ios:
  
# Track the sun
sun:

# Experimental replacement for dumb thermostat
# Keep alive repeats furnace ON or OFF message every 3 minutes
# Furnace Arduino will expect repeated furnace ON messages to keep the furnace relay ON.

climate:
  - platform: generic_thermostat
    name: House
    heater: switch.furnace
    target_sensor: sensor.temperature
    min_temp: 15
    max_temp: 25
    target_temp: !secret temperature_home
    tolerance: 0.3
    min_cycle_duration:
      seconds: 10
    keep_alive:
      minutes: 3

  - platform: generic_thermostat
    name: Summer Fan
    heater: switch.fan
    target_sensor: sensor.temperature
    min_temp: 22
    max_temp: 35
    target_temp: !secret temperature_fan
    tolerance: 0.3
    min_cycle_duration:
      seconds: 10
    ac_mode: true


# Used in automations to detect when I leave and come home again.  'on' = away
binary_sensor:
  - platform: template
    sensors:
      away:
        value_template: '{{ is_state("sensor.back_lock_last_action", "Locked: Outside Keypad")}}'
        friendly_name: 'I am away' 

input_boolean:
  vacation:
    name: "ON Vacation"
    initial: off
    icon: mdi:car
    
# Send notification if Home Assistant restarts after 10 minutes
# to wait for internet to come back up. I get an error if this is in the automation.yaml file
automation 2:
  trigger:
    platform: homeassistant
    event: start
  action:
    - service: homeassistant.turn_off
      data:
        entity_id: group.switches_off_at_restart
    - delay:
        minutes: 10
    - service: notify.ios_grahams_iphone
      data:
        message: "HA Restarted"
          

    
# Include other files to better organize code
group: !include groups.yaml
automation: !include automations.yaml
automation pre45: !include automation.yaml
sensor: !include sensors.yaml
switch: !include switches.yaml
script: !include scripts.yaml
